<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Chamados - Fiscal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">

  <!-- üîπ TAGS PWA -->
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#111111">
  <!-- iOS (opcional mas recomendado) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <style>
    h3 {
      font-weight: 700;
      margin-bottom: 2rem;
    }

    .table th {
      font-size: 0.95rem;
      text-transform: uppercase;
      font-weight: 600;
      text-align: center;
    }

    /* üîπ Destaque apenas ID, Loja, Descri√ß√£o e Prioridade */
    .prioridade-alta td:nth-child(1),
    .prioridade-alta td:nth-child(2),
    .prioridade-alta td:nth-child(3),
    .prioridade-alta td:nth-child(4) {
      background-color: rgba(220, 53, 69, 0.18) !important;
      font-weight: 600;
    }
    .prioridade-media td:nth-child(1),
    .prioridade-media td:nth-child(2),
    .prioridade-media td:nth-child(3),
    .prioridade-media td:nth-child(4) {
      background-color: rgba(255, 193, 7, 0.18) !important;
      font-weight: 600;
    }
    .prioridade-baixa td:nth-child(1),
    .prioridade-baixa td:nth-child(2),
    .prioridade-baixa td:nth-child(3),
    .prioridade-baixa td:nth-child(4) {
      background-color: rgba(40, 167, 69, 0.18) !important;
      font-weight: 600;
    }

    .card-custom {
      border-radius: 1rem;
      border: none;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }

    .card-title {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .btn-sm {
      font-size: 0.9rem;
      padding: 0.45rem 0.9rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body class="bg-light d-flex flex-column min-vh-100">

  <div class="container mt-5 flex-grow-1">
    <h3 class="text-center">üìã Chamados para Fiscal</h3>

    <!-- Mensagem de feedback -->
    {% if mensagem %}
    <div class="alert alert-info alert-dismissible fade show text-center" role="alert">
      {{ mensagem }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    {% if chamados %}
    <!-- Tabela no desktop -->
    <div class="table-responsive d-none d-md-block">
      <table class="table table-hover align-middle shadow-sm">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Loja</th>
            <th>Descri√ß√£o</th>
            <th>Prioridade</th>
            <th>Status</th>
            <th>Solicitado por</th>
            <th class="text-center">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for c in chamados %}
          <tr class="{% if c.prioridade == 'alta' %}prioridade-alta{% elif c.prioridade == 'm√©dia' %}prioridade-media{% elif c.prioridade == 'baixa' %}prioridade-baixa{% endif %}">
            <td>{{ c.id }}</td>
            <td>{{ c.loja }}</td>
            <td>{{ c.descricao }}</td>
            <td class="text-capitalize">{{ c.prioridade }}</td>
            <td>
              {% if c.status == "aberto" %}
                <span class="badge bg-primary">Aberto</span>
              {% elif c.status == "visualizado" %}
                <span class="badge bg-warning text-dark">Visualizado</span>
              {% elif c.status == "conclu√≠do" %}
                <span class="badge bg-success">Conclu√≠do</span>
              {% else %}
                <span class="badge bg-secondary">{{ c.status }}</span>
              {% endif %}
            </td>
            <td>{{ c.solicitado_por }}</td>
            <td class="text-center">
              {% if c.status != 'conclu√≠do' %}
                <form method="post" action="/fiscal/visualizar/{{ c.id }}" class="d-inline">
                  <button class="btn btn-warning btn-sm">üëÅ Visualizar</button>
                </form>
                <form method="post" action="/fiscal/concluir/{{ c.id }}" class="d-inline">
                  <button class="btn btn-success btn-sm">‚úÖ Concluir</button>
                </form>
              {% else %}
                <span class="text-success fw-bold">‚úÖ Conclu√≠do</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Cards no mobile -->
    <div class="d-md-none">
      {% for c in chamados %}
      <div class="card card-custom mb-3">
        <div class="card-body">
          <h5 class="card-title">Chamado #{{ c.id }} - {{ c.loja }}</h5>
          <p class="mb-1"><strong>Descri√ß√£o:</strong> {{ c.descricao }}</p>
          <p class="mb-1"><strong>Prioridade:</strong> {{ c.prioridade | capitalize }}</p>
          <p class="mb-1"><strong>Status:</strong>
            {% if c.status == "aberto" %}
              <span class="badge bg-primary">Aberto</span>
            {% elif c.status == "visualizado" %}
              <span class="badge bg-warning text-dark">Visualizado</span>
            {% elif c.status == "conclu√≠do" %}
              <span class="badge bg-success">Conclu√≠do</span>
            {% else %}
              <span class="badge bg-secondary">{{ c.status }}</span>
            {% endif %}
          </p>
          <p class="mb-3"><strong>Solicitado por:</strong> {{ c.solicitado_por }}</p>
          <div class="d-grid gap-2">
            {% if c.status != 'conclu√≠do' %}
            <form method="post" action="/fiscal/visualizar/{{ c.id }}">
              <button class="btn btn-warning btn-lg">üëÅ Visualizar</button>
            </form>
            <form method="post" action="/fiscal/concluir/{{ c.id }}">
              <button class="btn btn-success btn-lg">‚úÖ Concluir</button>
            </form>
            {% else %}
            <div class="text-success fw-bold">‚úÖ Conclu√≠do</div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
      <p class="alert alert-info text-center">Nenhum chamado dispon√≠vel.</p>
    {% endif %}

    <!-- Voltar -->
    <div class="text-center mt-4">
      <a href="/dashboard-fiscal" class="btn btn-secondary btn-lg">‚¨Ö Voltar</a>
    </div>
  </div>

  <!-- Rodap√© -->
  <footer class="footer text-center mt-4">
    <img src="/static/images/logo_text.png" alt="InfraCheck+" class="brand-logo mb-2" style="max-height: 32px;">
    <p class="text-muted mb-0"><small>Sistema de Chamados ‚Ä¢ InfraCheck+</small></p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- üîπ REGISTRO DO SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
